<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>12-churchencoding.scala</title>
  <link rel="stylesheet" href="../recources/style.css">
</head>
<body>
  <a href="https://github.com/klauso/PLT2012"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>
  <header>
  <nav>
    <ul>    
        <li><a href="10-gc.html">10-gc.scala</a></li>
        <li><a href="11-syntacticvsmeta.html">11-syntacticvsmeta.scala</a></li>
        <li><a href="12-churchencoding.html">12-churchencoding.scala</a></li>
        <li><a href="13-cpstransformation.html">13-cpstransformation.scala</a></li>
        <li><a href="2-ae.html">2-ae.scala</a></li>
        <li><a href="3-wae.html">3-wae.scala</a></li>
        <li><a href="4-f1wae.html">4-f1wae.scala</a></li>
        <li><a href="5-fae.html">5-fae.scala</a></li>
        <li><a href="6-lcfae.html">6-lcfae.scala</a></li>
        <li><a href="8-rcfae.html">8-rcfae.scala</a></li>
        <li><a href="9-bcfae.html">9-bcfae.scala</a></li>
    </ul>
  </nav>
  </header>
  <article id="documentation">
    <section id='section-1'>
      <div class="docs"><p>These are lecture notes for the &ldquo;Programming Languages and Types&rdquo; course by Klaus Ostermann 
at the University of Marburg</p>

<p>Please comment/correct/improve these notes via github. Proposals or questions can
be submitted as an &ldquo;issue&rdquo;; proposals for corrections/extensions/improvements can
be submitted as a &ldquo;pull request&rdquo;. You can of course also send an email to Klaus Ostermann</p></div>
      <div class="code"><code class='highlight'><pre></pre></code></div>
    </section>
    <section id='section-2'>
      <div class="docs"><p>Today we shrink our language. It does not seem to be big, but today we want to 
illustrate how powerful our core language, the lambda calculus, is.
Here is a shrinked version of FAE that does not even have numbers anymore.
For testing purposes, we introduce a new expression &ldquo;PrintDot&rdquo; whose semantics is
to print a dot on the screen. </p></div>
      <div class="code"><code class='highlight'><pre><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Exp</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Id</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">Symbol</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Exp</span>
<span class="k">implicit</span> <span class="k">def</span> <span class="n">id2exp</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">Symbol</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Id</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Fun</span><span class="o">(</span><span class="n">param</span><span class="k">:</span> <span class="kt">Symbol</span><span class="o">,</span> <span class="n">body</span><span class="k">:</span> <span class="kt">Exp</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Exp</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">App</span> <span class="o">(</span><span class="n">funExpr</span><span class="k">:</span> <span class="kt">Exp</span><span class="o">,</span> <span class="n">argExpr</span><span class="k">:</span> <span class="kt">Exp</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Exp</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">PrintDot</span><span class="o">()</span> <span class="k">extends</span> <span class="nc">Exp</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Value</span> <span class="c1">// the only values are closures</span>
<span class="k">type</span> <span class="kt">Env</span> <span class="o">=</span> <span class="nc">Map</span><span class="o">[</span><span class="kt">Symbol</span>, <span class="kt">Value</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">ClosureV</span><span class="o">(</span><span class="n">f</span><span class="k">:</span><span class="kt">Fun</span><span class="o">,</span> <span class="n">env</span><span class="k">:</span><span class="kt">Env</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Value</span></pre></code></div>
    </section>
    <section id='section-3'>
      <div class="docs"><p>Notice that the only values in this language are closures.
This means that there cannot be the situation anymore that
we expect, say, a number but get in fact a closure.
Hence, this language has the fascinating property that 
no dynamic type errors can occur.</p></div>
      <div class="code"><code class='highlight'><pre> 
<span class="k">def</span> <span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="k">:</span> <span class="kt">Exp</span><span class="o">,</span> <span class="n">env</span><span class="k">:</span> <span class="kt">Env</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Value</span> <span class="o">=</span> <span class="n">e</span> <span class="k">match</span> <span class="o">{</span>
  <span class="c1">// We give the identity function as dummy value for PrintDot</span>
  <span class="k">case</span> <span class="nc">PrintDot</span><span class="o">()</span> <span class="k">=&gt;</span> <span class="n">print</span><span class="o">(</span><span class="s">&quot;.&quot;</span><span class="o">);</span> <span class="nc">ClosureV</span><span class="o">(</span><span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;x</span><span class="o">,</span><span class="-Symbol">&#39;x</span><span class="o">),</span> <span class="nc">Map</span><span class="o">.</span><span class="n">empty</span><span class="o">)</span> 
  <span class="k">case</span> <span class="nc">Id</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">env</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
  <span class="k">case</span> <span class="n">f</span><span class="nd">@Fun</span><span class="o">(</span><span class="n">param</span><span class="o">,</span><span class="n">body</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">ClosureV</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">env</span><span class="o">)</span>
  <span class="k">case</span> <span class="nc">App</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">eval</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">env</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">ClosureV</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">closureEnv</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">eval</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="n">body</span><span class="o">,</span> <span class="n">closureEnv</span> <span class="o">+</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="n">param</span> <span class="o">-&gt;</span> <span class="n">eval</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">env</span><span class="o">)))</span>
  <span class="o">}</span>
<span class="o">}</span></pre></code></div>
    </section>
    <section id='section-4'>
      <div class="docs"><p>Now we want to illustrate that we can, in principle, bootstrap a full
programming language from this small core. To do so, we use the technique
of Church encoding, which you already learnt in the first lecture, this
time using pure functions. This means that each datum is represented by
its own fold function.</p>

<p>Let&rsquo;s start with booleans and boolean arithmetic.</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">f</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;t</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;f</span><span class="o">,</span> <span class="-Symbol">&#39;f</span><span class="o">))</span>  <span class="c1">// false</span>
<span class="k">val</span> <span class="n">t</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;t</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;f</span><span class="o">,</span> <span class="-Symbol">&#39;t</span><span class="o">))</span>  <span class="c1">// true</span>
<span class="k">val</span> <span class="n">and</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="-Symbol">&#39;b</span><span class="o">),</span><span class="-Symbol">&#39;a</span><span class="o">)))</span>
<span class="k">val</span> <span class="n">or</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="-Symbol">&#39;a</span><span class="o">),</span> <span class="-Symbol">&#39;b</span><span class="o">)))</span>
<span class="k">val</span> <span class="n">not</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;t</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;f</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span><span class="-Symbol">&#39;f</span><span class="o">),</span><span class="-Symbol">&#39;t</span><span class="o">))))</span></pre></code></div>
    </section>
    <section id='section-5'>
      <div class="docs"><p>We can now write our own control structures, such as if/then/else</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">ifthenelse</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;cond</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;t</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;f</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;cond</span><span class="o">,</span> <span class="-Symbol">&#39;t</span><span class="o">),</span> <span class="-Symbol">&#39;f</span><span class="o">))))</span></pre></code></div>
    </section>
    <section id='section-6'>
      <div class="docs"><p>Let&rsquo;s now consider Numbers. We encode them as Peano numbers. 
These encodings of numbers are often called &ldquo;Church numerals&rdquo;.</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">zero</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;s</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;z</span><span class="o">,</span> <span class="-Symbol">&#39;z</span><span class="o">))</span>
<span class="k">val</span> <span class="n">succ</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;n</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;s</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;z</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;s</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;n</span><span class="o">,</span> <span class="-Symbol">&#39;s</span><span class="o">),</span><span class="-Symbol">&#39;z</span><span class="o">)))))</span>
<span class="k">val</span> <span class="n">one</span> <span class="k">=</span> <span class="nc">App</span><span class="o">(</span><span class="n">succ</span><span class="o">,</span> <span class="n">zero</span><span class="o">)</span>
<span class="k">val</span> <span class="n">two</span> <span class="k">=</span> <span class="nc">App</span><span class="o">(</span><span class="n">succ</span><span class="o">,</span> <span class="n">one</span><span class="o">)</span>
<span class="k">val</span> <span class="n">three</span> <span class="k">=</span> <span class="nc">App</span><span class="o">(</span><span class="n">succ</span><span class="o">,</span> <span class="n">two</span><span class="o">)</span>
<span class="k">val</span> <span class="n">add</span>  <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;s</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;z</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span><span class="-Symbol">&#39;s</span><span class="o">),</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="-Symbol">&#39;s</span><span class="o">),</span><span class="-Symbol">&#39;z</span><span class="o">))))))</span>
<span class="k">val</span> <span class="n">mult</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;s</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;z</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span><span class="-Symbol">&#39;s</span><span class="o">)),</span> <span class="-Symbol">&#39;z</span><span class="o">)))))</span>
<span class="k">val</span> <span class="n">exp</span>  <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;b</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="n">mult</span><span class="o">,</span> <span class="-Symbol">&#39;a</span><span class="o">)),</span> <span class="n">one</span><span class="o">)))</span>
<span class="k">val</span> <span class="n">iszero</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;x</span><span class="o">,</span> <span class="n">f</span><span class="o">)),</span> <span class="n">t</span><span class="o">))</span></pre></code></div>
    </section>
    <section id='section-7'>
      <div class="docs"><p>The predecessor function is more complicated (why?). We do not show it here.</p></div>
      <div class="code"><code class='highlight'><pre></pre></code></div>
    </section>
    <section id='section-8'>
      <div class="docs"><p>For testing, here is a function that prints a unary representation of a number.</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">printnum</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;a</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;x</span><span class="o">,</span> <span class="nc">PrintDot</span><span class="o">())),</span> <span class="n">f</span><span class="o">))</span></pre></code></div>
    </section>
    <section id='section-9'>
      <div class="docs"><p>Church encoding of lists. Again straightforward, except &ldquo;tail&rdquo;, which we do not
show here. It needs the same kind of trick (called &ldquo;pairing trick&rdquo;) as the predecessor
function.</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">emptylist</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;c</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;e</span><span class="o">,</span> <span class="-Symbol">&#39;e</span><span class="o">))</span>
<span class="k">val</span> <span class="n">cons</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;h</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;r</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;c</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;e</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;c</span><span class="o">,</span> <span class="-Symbol">&#39;h</span><span class="o">),</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;r</span><span class="o">,</span><span class="-Symbol">&#39;c</span><span class="o">),</span><span class="-Symbol">&#39;e</span><span class="o">))))))</span>
<span class="k">val</span> <span class="n">head</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;l</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;l</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;h</span><span class="o">,</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;t</span><span class="o">,</span> <span class="-Symbol">&#39;h</span><span class="o">))),</span> <span class="n">f</span><span class="o">))</span></pre></code></div>
    </section>
    <section id='section-10'>
      <div class="docs"><p>For instance, we can multiply all numbers in a list</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">multlist</span> <span class="k">=</span> <span class="nc">Fun</span><span class="o">(</span><span class="-Symbol">&#39;l</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="-Symbol">&#39;l</span><span class="o">,</span> <span class="n">mult</span><span class="o">),</span> <span class="n">one</span><span class="o">))</span></pre></code></div>
    </section>
    <section id='section-11'>
      <div class="docs"><p>Here is the list 3,2,3</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">val</span> <span class="n">list323</span> <span class="k">=</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="n">cons</span><span class="o">,</span> <span class="n">three</span><span class="o">),</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="n">cons</span><span class="o">,</span> <span class="n">two</span><span class="o">),</span> <span class="nc">App</span><span class="o">(</span><span class="nc">App</span><span class="o">(</span><span class="n">cons</span><span class="o">,</span><span class="n">three</span><span class="o">),</span><span class="n">emptylist</span><span class="o">)))</span>

<span class="k">val</span> <span class="n">test</span> <span class="k">=</span> <span class="nc">App</span><span class="o">(</span><span class="n">printnum</span><span class="o">,</span> <span class="nc">App</span><span class="o">(</span><span class="n">multlist</span><span class="o">,</span> <span class="n">list323</span><span class="o">))</span></pre></code></div>
    </section>
    <section id='section-12'>
      <div class="docs"><p>Calling exec should yield 18 dots before the dummy result</p></div>
      <div class="code"><code class='highlight'><pre><span class="k">def</span> <span class="n">exec</span> <span class="k">=</span> <span class="n">eval</span><span class="o">(</span><span class="n">test</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="n">empty</span><span class="o">)</span> </pre></code></div>
    </section>
    <section id='section-13'>
      <div class="docs"><p>Topic for class discussion: Can we do these encodings directly in Scala or Haskell?</p>
</div>
      <div class="code"><code class='highlight'><pre></pre></code></div>
    </section>
  </article>
</body>
